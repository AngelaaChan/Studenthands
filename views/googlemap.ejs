<!DOCTYPE html >


<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>googlemap testing</title>

    <meta name="viewport" content="width=device-width, initial-scale=1 shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="/css/register.css" rel="stylesheet" media="all">

    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900" rel="stylesheet" />
    <link href="/css/default.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/css/fonts.css" rel="stylesheet" type="text/css" media="all" />

    <!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
        width: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
</head>
<body>


<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"><b>Studenthands</b></a>
        <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Find Tutors<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="/searchTutorRate">By Rate</a></li>
                    <li><a href="/searchTutorSub">By Location</a></li>
                    <li><a href="/searchTutorSub">By Subjects</a></li>
                </ul>
            </li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Discussion Forum<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="/discussionforum">Search Questions</a></li>
                    <li><a href="#">Ask Questions</a></li>
                </ul>
            </li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Weekly Challenge<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="/challenge">Current hallenges</a></li>
                    <li><a href="/ranking">Ranking</a></li>
                </ul>
            </li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Learning Resources<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="/challenge">Search Materials</a></li>
                    <li><a href="/ranking">Share Materials</a></li>
                </ul>
            </li>

        </ul>
        <ul class="nav navbar-nav navbar-right">
            <%if(!user){%>
            <li><a href="/Login"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            <li><a href="/Register"><span class="glyphicon glyphicon-user"></span> Sign up</a></li>
            <%}else{%>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="glyphicon glyphicon-user"></span><%=user.username%><span class="caret"></a>
                <ul class="dropdown-menu">
                    <li><a href="/userinfo">User information</a></li>
                    <li><a href="#">Top up</a></li>
                    <li><a href="/getmessage">Message</a></li>
                    <li><a href="/Logout">Logout</a></li>
                </ul>
            </li>
            <%}%>
        </ul>
    </div>
</nav>


<div class="name">Google Map testing</div>
<div id="map"></div>
<script>
    function initMap(){
      // Map options
      var options = {
        zoom:8,
        center:{lat:-37.83,lng:144.995}
      }

      // New map
      var map = new google.maps.Map(document.getElementById('map'), options);

      // Listen for click on map
      google.maps.event.addListener(map, 'click', function(event){
        // Add marker
        addMarker({coords:event.latLng});
        console.log(event.latLng.lat(),event.latLng.lng());
        var data = 'lat='+event.latLng.lat()+'&lng='+event.latLng.lng();
        var XHR=null;  
        if (window.XMLHttpRequest) {   
            //ie 内核
            XHR = new XMLHttpRequest();  
        } else if (window.ActiveXObject) {    
            XHR = new ActiveXObject("Microsoft.XMLHTTP");  
        } else {  
            XHR = null;  
        }  
        
        if(XHR){  
            XHR.open("POST", "/findpos",true);  
            XHR.onreadystatechange = function () {  
                // readyState值说明  
                // 0,初始化,XHR对象已经创建,还未执行open  
                // 1,载入,已经调用open方法,但是还没发送请求  
                // 2,载入完成,请求已经发送完成  
                // 3,交互,可以接收到部分数据  
        
                // status值说明  
                // 200:成功  
                // 404:没有发现文件、查询或URl  
                // 500:服务器产生内部错误  
                if (XHR.readyState == 4 && XHR.status == 200) {  
                    // 这里可以对返回的内容做处理  
                    // 一般会返回JSON或XML数据格式  
                    console.log(XHR.responseText);
                    var text = JSON.parse(XHR.responseText);
                    console.log(text);
                    for (var i = 0;i<text.length;i++){
                        if (text[i].coord){
                            addMarker({"coords":text[i].coord});
                            //console.log(XHR.responseText[i].coord);

                        }
                    } 
                    // 主动释放,JS本身也会回收的  
                    XHR = null;  
                }  
            }; 
            XHR.setRequestHeader("Content-type","application/json");  
            //XHR.setRequestHeader("Content-type","application/x-www-form-urlencoded"); 
            // XHR.send(JSON.stringify(data));  //如果是对象格式的数据就要转换成jsonstring  
            XHR.send(data);
        }
      });

      /*
      // Add marker
      var marker = new google.maps.Marker({
        position:{lat:42.4668,lng:-70.9495},
        map:map,
        icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
      });

      var infoWindow = new google.maps.InfoWindow({
        content:'<h1>Lynn MA</h1>'
      });

      marker.addListener('click', function(){
        infoWindow.open(map, marker);
      });
      */

      // Array of markers
      var markers = [
        {
          coords:{lat:42.4668,lng:-70.9495},
          iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
          content:'<h1>Lynn MA</h1>'
        }
      ];

      // Loop through markers
      for(var i = 0;i < markers.length;i++){
        // Add marker
        addMarker(markers[i]);
      }

      // Add Marker Function
      function addMarker(props){
        var marker = new google.maps.Marker({
          position:props.coords,
          map:map,
          //icon:props.iconImage
        });

        // Check for customicon
        if(props.iconImage){
          // Set icon image
          marker.setIcon(props.iconImage);
        }

        // Check content
        if(props.content){
          var infoWindow = new google.maps.InfoWindow({
            content:props.content
          });

          marker.addListener('click', function(){
            infoWindow.open(map, marker);
          });
        }
      }
    }
</script>

<button id="delete-button" class="btn btn--radius-2 btn--green">Delete select shape </button>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGUl7T83zKY3A96GUBQSITe1b7hu0aq5A&libraries=drawing&callback=initMap">
</script>
</body>


<div id="copyright" class="container">
    <p>&copy; Keep Typing</p>
</div>
</body>
</html>